@using BoardBrawl.WebApp.MVC.Areas.Game.Models;
@model PlayerBoard

<style>
    .focusedPlayer {
        outline: 2px solid yellow;
    }
</style>

<div class="d-flex flex-column h-100 overflow-auto">
    <ul class="nav h-100">
        @foreach (var playerInfo in Model.Players)
        {
            <li class="nav-item">
                @{
                    <div id="playerInfo@(playerInfo.UserId)">@await Component.InvokeAsync("PlayerInfo", playerInfo)</div>

                    var isFocusedPlayer = Model.ActivePlayerUserId == playerInfo.UserId ? "focusedPlayer" : "";
                    @if (playerInfo.UserId == Model.UserId)
                    {
                        <video class="playerVideo localVideo @(isFocusedPlayer)" muted style="width:100%"></video>
                        <div class="errorImage" style="display:none"><img src="~/images/game/error-image-generic.png" /></div>
                    }
                    else
                    {
                        <video class="playerVideo remoteVideo @(isFocusedPlayer)" style="width:100%" data-userid="@playerInfo.UserId" data-peerid="@playerInfo.PeerId"></video>
                    }
                }


                @*TODO:View components do not allow rendering scripts like this in the Scripts section. Refactor to get it out of the moddle of hte html anywa*@
                <script>
                    $(document).ready(function () {
                        $(document).off('click', '#btnDecreaseLife@(playerInfo.UserId)')

                        $(document).on('click', '#btnDecreaseLife@(playerInfo.UserId)', function () {
                            $.ajax({
                                url: '/Game/Home/DecreaseLifeTotal',
                                data: {
                                    gameId: '@(Model.GameId)',
                                    userId: '@(playerInfo.UserId)',
                                    amount: 1
                                },
                                success: function (html) {
                                    $('#playerInfo@(playerInfo.UserId)').html(html);
                                }
                            });
                        });

                        $(document).off('click', '#btnIncreaseLife@(playerInfo.UserId)')

                        $(document).on('click', '#btnIncreaseLife@(playerInfo.UserId)', function () {
                            $.ajax({
                                url: '/Game/Home/IncreaseLifeTotal',
                                data: {
                                    gameId: '@(Model.GameId)',
                                    userId: '@(playerInfo.UserId)',
                                    amount: 1
                                },
                                success: function (html) {
                                    $('#playerInfo@(playerInfo.UserId)').html(html);
                                }
                            });
                        });
                    });
                </script>
            </li>
        }
    </ul>
</div>